<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Rgemini">
<title>Daily Census • Rgemini</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Daily Census">
<meta property="og:description" content="Rgemini">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Rgemini</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/cell_suppression_and_table1.html">Cell Suppression and Table 1</a>
    <a class="dropdown-item" href="../articles/daily_census.html">Daily Census</a>
    <a class="dropdown-item" href="../articles/epicare_and_readmission.html">Episodes of care and Readmission</a>
    <a class="dropdown-item" href="../articles/icd_to_ccsr.html">ICD to CCSR</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Daily Census</h1>
            
            <h4 data-toc-skip class="date">2023-08-15</h4>
      
      
      <div class="d-none name"><code>daily_census.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>daily_census</code> function calculates the number of
patients that were hospitalized at a given hospital on each day during a
time period of interest. The <code>census</code> provides a
cross-sectional count of patients that occupied a hospital bed at 8am
(by default) each day. Specifically, it is calculated as the number of
patients who were admitted before that time point and discharged after
that time point. The function also returns a <code>capacity_ratio</code>
indicating whether the number of patients on a given day was higher
(&gt;1) or lower (&lt;1) than on a typical day, where by default,
typical occupancy is based on the median census during the time period
of interest.</p>
<p><strong>Note:</strong> Although this function can be applied to
different cohorts and research contexts, the interpretation of the
function outputs may vary according to the inputs users provide. For
example, if users pre-filter their cohort based on certain diagnosis
criteria, the <code>census</code> counts will only include those
patients, and similarly, the <code>capacity_ratio</code> would not
reflect a real indicator of capacity, but rather a measure of whether
occupancy is above/below typical occupancy <em>for a certain group of
patients</em> (also see <a href="#grouping"><em>section on group_var
input</em></a> below).</p>
</div>
<div class="section level2">
<h2 id="running-daily_census-with-default-arguments">Running <code>daily_census()</code> with default arguments<a class="anchor" aria-label="anchor" href="#running-daily_census-with-default-arguments"></a>
</h2>
<p>To run the <code>daily_census</code> function, users need to provide
an input table <code>cohort</code> containing all encounters that are
part of their cohort of interest. Typically, the cohort is created based
on the <code>admdad</code> table (or a subset thereof) in the GEMINI
database. It needs to contain the columns <code>genc_id</code>,
<code>hospital_num</code>, <code>admission_date_time</code>, and
<code>discharge_date_time</code>.</p>
<p>Here is an example of how to load the relevant data and run the
<code>daily_census</code> function with default settings:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load necessary libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tomoakin/RPostgreSQL" class="external-link">RPostgreSQL</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wrathematics/getPass" class="external-link">getPass</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Establish database connection</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="va">drv</span>,</span>
<span>                     dbname <span class="op">=</span> <span class="st">"DB_name"</span>,</span>
<span>                     host <span class="op">=</span> <span class="st">"172.XX.XX.XXX"</span>,</span>
<span>                     port <span class="op">=</span> <span class="fl">1234</span>,</span>
<span>                     user <span class="op">=</span> <span class="fu">getPass</span><span class="op">(</span><span class="st">"Enter user:"</span><span class="op">)</span>,</span>
<span>                     password <span class="op">=</span> <span class="fu">getPass</span><span class="op">(</span><span class="st">"Enter Password:"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># query admdad table containing cohort (could be filtered further if necessary)</span></span>
<span><span class="va">admdad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"SELECT genc_id, hospital_num, admission_date_time, discharge_date_time FROM admdad;"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Run default daily_census calculation         </span></span>
<span><span class="va">census_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/daily_census.html">daily_census</a></span><span class="op">(</span>cohort <span class="op">=</span> <span class="va">admdad</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">census_output</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>Mock output table (for illustration purposes, not real
data):</strong></p>
</blockquote>
<table class="table">
<thead><tr class="header">
<th align="center">date_time</th>
<th align="center">hospital_num</th>
<th align="center">census</th>
<th align="center">capacity_ratio</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">2016-04-01T08:00:00Z</td>
<td align="center">1</td>
<td align="center">237</td>
<td align="center">0.9834025</td>
</tr>
<tr class="even">
<td align="center">2016-04-01T08:00:00Z</td>
<td align="center">2</td>
<td align="center">168</td>
<td align="center">1.0181818</td>
</tr>
<tr class="odd">
<td align="center">2016-04-01T08:00:00Z</td>
<td align="center">3</td>
<td align="center">140</td>
<td align="center">1.0294118</td>
</tr>
<tr class="even">
<td align="center">2016-04-01T08:00:00Z</td>
<td align="center">4</td>
<td align="center">159</td>
<td align="center">1.1521739</td>
</tr>
<tr class="odd">
<td align="center">2016-04-01T08:00:00Z</td>
<td align="center">5</td>
<td align="center">115</td>
<td align="center">0.9913793</td>
</tr>
<tr class="even">
<td align="center">2016-04-02T08:00:00Z</td>
<td align="center">1</td>
<td align="center">225</td>
<td align="center">0.9336100</td>
</tr>
<tr class="odd">
<td align="center">2016-04-02T08:00:00Z</td>
<td align="center">2</td>
<td align="center">157</td>
<td align="center">0.9515152</td>
</tr>
<tr class="even">
<td align="center">2016-04-02T08:00:00Z</td>
<td align="center">3</td>
<td align="center">138</td>
<td align="center">1.0147059</td>
</tr>
<tr class="odd">
<td align="center">2016-04-02T08:00:00Z</td>
<td align="center">4</td>
<td align="center">158</td>
<td align="center">1.1449275</td>
</tr>
<tr class="even">
<td align="center">2016-04-02T08:00:00Z</td>
<td align="center">5</td>
<td align="center">108</td>
<td align="center">0.9310345</td>
</tr>
</tbody>
</table>
<p>This table shows an example output for data from 5 hospitals from
April 2016 - April 2017. Each row corresponds to a unique combination of
<code>date_time</code> (with a reference time of 8am, by default) and
hospital ID (<code>hospital_num</code>). The <code>census</code>
variable indicates the count of patients that were occupying a bed at
8am each day at a given hospital. The <code>capacity_ratio</code> refers
to a relative measure of bed occupancy, which by default is calculated
as <code>census/median(census)</code>.</p>
<p>Based on this table, users could extract further information, such as
the median daily census at each hospital during the study period:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span> <span class="co">#  we are using data.table operations below, but users could also use tidyverse to analyze the function output</span></span>
<span></span>
<span><span class="co"># Compute median census at each site</span></span>
<span><span class="va">median_census</span> <span class="op">&lt;-</span> <span class="va">census_output</span><span class="op">[</span> , <span class="fu">.</span><span class="op">(</span>median_census <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">census</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">hospital_num</span><span class="op">]</span> </span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="center">hospital_num</th>
<th align="center">median_census</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">241</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">165</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">136</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">138</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">116</td>
</tr>
</tbody>
</table>
<p>Additionally, users could plot <code>census</code> and
<code>capacity_ratio</code> over time, separately for each hospital:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot census over time</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">census_output</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span>, y<span class="op">=</span><span class="va">census</span>, group <span class="op">=</span> <span class="va">hospital_num</span>, color<span class="op">=</span><span class="va">hospital_num</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">1.5</span>,show.legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Date'</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">census_output</span><span class="op">$</span><span class="va">date_time</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">census_output</span><span class="op">$</span><span class="va">date_time</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"1 months"</span><span class="op">)</span>, date_labels <span class="op">=</span> <span class="st">"%b\n%Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Mock figure: Daily census by hospital"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="daily_census_files/figure-html/unnamed-chunk-5-1.png" width="80%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot capacity ratio over time</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">census_output</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span>, y<span class="op">=</span><span class="va">capacity_ratio</span>, group <span class="op">=</span> <span class="va">hospital_num</span>, color<span class="op">=</span><span class="va">hospital_num</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth<span class="op">=</span><span class="fl">1.5</span>,show.legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Date'</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">census_output</span><span class="op">$</span><span class="va">date_time</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">census_output</span><span class="op">$</span><span class="va">date_time</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"1 months"</span><span class="op">)</span>, date_labels <span class="op">=</span> <span class="st">"%b\n%Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Mock figure: Daily capacity ratio by hospital"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="daily_census_files/figure-html/unnamed-chunk-6-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>Note that <code>capacity_ratio</code> fluctuates around 1 (= typical
occupancy) where values &gt; 1 correspond to days with higher occupancy
than usual.</p>
</div>
<div class="section level2">
<h2 id="optional-input-arguments">Optional input arguments<a class="anchor" aria-label="anchor" href="#optional-input-arguments"></a>
</h2>
<div class="section level3">
<h3 id="time_period">
<code>time_period</code><a class="anchor" aria-label="anchor" href="#time_period"></a>
</h3>
<p>By default, the function will calculate the census for the whole time
period that is available in the <code>cohort</code> table. Note that
data availability may differ by hospital, and the function will
determine data availability individually for each site. If users only
want to calculate the census for a certain time period within their
overall cohort, they can provide an optional <code>time_period</code>
input specifying a start and end date.</p>
<p>For example, to calculate the census from June 1, 2016 - Dec 31,
2016:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute census for specific time period</span></span>
<span><span class="va">census_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/daily_census.html">daily_census</a></span><span class="op">(</span><span class="va">admdad</span>, time_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2016-06-01"</span>,<span class="st">"2016-12-31"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Note that in this case, the <code>capacity_ratio</code> is calculated
based on the typical occupancy observed during that same time period
(i.e., between June-Dec 2016).</p>
</div>
<div class="section level3">
<h3 id="scu_exclude">
<code>scu_exclude</code><a class="anchor" aria-label="anchor" href="#scu_exclude"></a>
</h3>
<p>By default, the total duration of each encounter’s hospital stay is
considered in the census counts. However, for certain projects, it may
be of interest to exclude any time points where the encounter was in a
special care unit (SCU), such as intensive care (ICU). This is relevant
if researchers want to analyse bed occupancy at a particular medical
ward (e.g., GIM) and only want to count patients who were in fact
occupying a bed in that ward on a given day, while excluding any
patients who were in an SCU.</p>
<p>In that case, users should provide an <code>scu_exclude</code> table
that contains all SCU encounters that should be excluded from the census
calculation. Note: The SCU table typically refers to the
<code>ipscu</code> table in the GEMINI database, however, users may want
to further filter that table by relevant <code>scu_unit_numbers</code>
that should be excluded from the census counts. The function
automatically removes any entries where
<code>scu_unit_number = 99</code>, which refers to encounters with
<code>"no SCU"</code>. Additionally, only SCU encounters with a valid
<code>scu_admit_date_time</code> and
<code>scu_discharge_date_time</code> can be excluded from the census.
Availability of these variables is low for certain cohorts and SCU
units. Therefore, users are advised to carefully inspect the SCU table
to make an informed decision about whether to exclude SCU encounters,
and if yes, which SCU entries to exclude.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># exclude SCU encounters from census</span></span>
<span><span class="va">scu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"SELECT * FROM ipscu;"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Compute census excluding SCU</span></span>
<span><span class="va">census_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/daily_census.html">daily_census</a></span><span class="op">(</span><span class="va">admdad</span>, scu_exclude <span class="op">=</span> <span class="va">scu</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="grouping">
<code>group_var</code><a class="anchor" aria-label="anchor" href="#grouping"></a>
</h3>
<p>By default, the census is calculated separately for each hospital (by
<code>hospital_num</code>). Users can specify additional grouping
variables to obtain patient counts (and capacity ratios) for subgroups
of interest, such as different medical subservices or physicians.</p>
<p>Here is a simple example where census is grouped by patients’ gender
and age (&lt;65 vs. 65+):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create age category</span></span>
<span><span class="va">admdad</span><span class="op">$</span><span class="va">age_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">admdad</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">65</span>,<span class="st">'&lt;=65'</span>,<span class="st">'&gt;65'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute census by gender &amp; age categories</span></span>
<span><span class="va">census_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/daily_census.html">daily_census</a></span><span class="op">(</span><span class="va">admdad</span>, group_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gender"</span>,<span class="st">"age_cat"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">census_output</span>,<span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p><strong>Mock output table showing census grouping by age &amp; gender
categories:</strong></p>
</blockquote>
<table class="table">
<colgroup>
<col width="18%">
<col width="28%">
<col width="11%">
<col width="10%">
<col width="10%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">hospital_num</th>
<th align="center">date_time</th>
<th align="center">age_cat</th>
<th align="center">gender</th>
<th align="center">census</th>
<th align="center">capacity_ratio</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">2016-04-01T08:00:00Z</td>
<td align="center">&lt;=65</td>
<td align="center">M</td>
<td align="center">27</td>
<td align="center">1.0384615</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2016-04-01T08:00:00Z</td>
<td align="center">&gt;65</td>
<td align="center">M</td>
<td align="center">87</td>
<td align="center">1.0235294</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">2016-04-01T08:00:00Z</td>
<td align="center">&lt;=65</td>
<td align="center">F</td>
<td align="center">28</td>
<td align="center">1.2173913</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2016-04-01T08:00:00Z</td>
<td align="center">&gt;65</td>
<td align="center">F</td>
<td align="center">95</td>
<td align="center">0.9500000</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">2016-04-02T08:00:00Z</td>
<td align="center">&lt;=65</td>
<td align="center">M</td>
<td align="center">23</td>
<td align="center">0.8846154</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">2016-04-02T08:00:00Z</td>
<td align="center">&gt;65</td>
<td align="center">M</td>
<td align="center">90</td>
<td align="center">1.0588235</td>
</tr>
</tbody>
</table>
<p>Note that <code>capacity_ratio</code> in this mock example should not
be interpreted as a real “capacity” indicator, but rather, as a measure
of whether on a given day there were more (&gt;1) or less (&lt;1)
patients of a certain age/gender than on a typical day.
<code>Capacity_ratio</code> is more useful for grouping variables that
correspond to separate medical entities, such as different medical
subservices or wards, where <code>capacity_ratio</code> can serve as an
indicator of system load vs. capacity. Nevertheless, grouping variables
that are based on patient characteristics (age, gender, diagnosis group,
illness severity etc.) could be useful to analyse the case mix of
hospitalized patients during certain periods of time.</p>
</div>
<div class="section level3">
<h3 id="capacity_func">
<code>capacity_func</code><a class="anchor" aria-label="anchor" href="#capacity_func"></a>
</h3>
<p>By default, <code>capacity_ratio</code> is defined as
<code>census/median(census)</code>, which is calculated separately for
each hospital and grouping variable (if any). That is,
<code>capacity_ratio</code> refers to the daily count of patients
relative to typical bed occupancy, where typical bed occupancy is
defined as the median census during the time period of interest.
Alternatively, users can specify other measures of central tendency to
obtain typical occupancy (“<code>mean</code>”, “<code>mode</code>”) or
estimate capacity based on the maximum occupancy
(“<code>max</code>”).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get occupancy relative to max capacity (estimated based on max(census))</span></span>
<span><span class="va">census_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/daily_census.html">daily_census</a></span><span class="op">(</span><span class="va">admdad</span>, capacity_func <span class="op">=</span> <span class="st">"max"</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="time_of_day">
<code>time_of_day</code><a class="anchor" aria-label="anchor" href="#time_of_day"></a>
</h3>
<p>By default, the census is calculated at 8am each day during the study
period. For example, to obtain the patient counts for April 1st, 2016
the function counts all patients with
<code>admission_date_time &lt;= '2015-04-01 08:00:00'</code> and
<code>discharge_date_time &gt;= '2015-04-01 08:00:00'</code>. Users can
specify a different reference time by providing an optional
<code>time_of_day</code> input:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate census at 2.30pm each day</span></span>
<span><span class="va">census_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/daily_census.html">daily_census</a></span><span class="op">(</span><span class="va">admdad</span>, time_of_day <span class="op">=</span> <span class="st">"14:30:00"</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="buffer">
<code>buffer</code><a class="anchor" aria-label="anchor" href="#buffer"></a>
</h3>
<p>For time periods that are towards the end of the data availability
timeline of a given hospital, users may observe a pattern similar to
this, where census counts suddenly drop at the end of the specified time
period:</p>
<p><img src="daily_census_files/figure-html/unnamed-chunk-13-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>This effect is due to a truncation bias that can occur if the end of
the specified time period (here April 2018) is close to the last
available date in the overall cohort (e.g., the cohort only contains
encounters up to April 2018 in this example). Note that cohorts are
typically defined by <em>discharge</em> date. That is, if a cohort
includes data from April 2017 - April 2018, it will only include
encounters that were <em>discharged</em> during that time. As a result,
there may be patients who were admitted during the last week of April
2018, but were not discharged prior to the end of the month. Therefore,
they are not part of the cohort, and cannot be counted towards the
census.</p>
<p>To prevent this from biasing the <code>census</code> and
<code>capacity_ratio</code> estimates, the function automatically checks
for data availability at each hospital based on the min and max dates in
the <code>cohort</code> input table. If data availability ends prior to
(or at the same time as) the end of the time period of interest, a
buffer period of 30 days is applied by default. Specifically, the last
30 days at each site will be set to <code>NA</code>. The default setting
of 30 days is based on the observation that the vast majority of
hospital stays are &lt; 30 days, and therefore, we can be confident that
patients who where hospitalized 30 days prior to the end of the
specified time period have already been discharged (i.e., are included
in the cohort).</p>
<p>The default setting of <code>buffer = 30</code> will result in the
following output, which removes the truncation bias shown in the
previous figure by setting the last 30 days of the time period to
<code>NA</code>:</p>
<p><img src="daily_census_files/figure-html/unnamed-chunk-14-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>Users can specify other buffer periods (in full days) based on their
cohort (and the typical length of stay observed in that cohort). For
example, to set the buffer period to 10 days, run the following
code:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify buffer of 10 days at end of time period</span></span>
<span><span class="va">census_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/daily_census.html">daily_census</a></span><span class="op">(</span><span class="va">admdad</span>, buffer <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span></code></pre></div>
<p>Note: In this example, if users specify a <code>time_period</code>
input that ends 10 days earlier than the latest available data, the
buffer period will be ignored and all available data will be used to
calculate census for the time period of interest. In other words, the
actual buffer period that is applied within the function depends on a
combination of the specified time period, data availability per site,
and the buffer argument in order to ensure that the maximum amount of
available data are used in the census calculation.</p>
</div>
</div>
<div class="section level2">
<h2 id="calculating-customized-measures-of-capacity">Calculating customized measures of capacity<a class="anchor" aria-label="anchor" href="#calculating-customized-measures-of-capacity"></a>
</h2>
<p>In addition to the flexibility provided by the function itself, users
may want to obtain additional capacity indicators that are currently not
supported by the function. For example, researchers may want to
calculate <code>capacity_ratio</code> relative to the typical occupancy
on a <strong>year-over-year basis</strong>. The function calculates
<code>capacity_ratio</code> by estimating typical (or max) capacity
based on census numbers throughout the whole time period. However, the
census may vary on a year-by-year basis. In that case, users could
either run the <code><a href="../reference/daily_census.html">daily_census()</a></code> function separately for each
study year, or they could run the function on the whole time period and
calculate a year-over-year <code>capacity_ratio</code> based on the raw
<code>census</code> output provided by the function, e.g.:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate capacity_ratio based on median census *per year*</span></span>
<span><span class="va">census_output</span><span class="op">[</span> , <span class="va">year</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">census_output</span><span class="op">$</span><span class="va">date_time</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">census_output</span><span class="op">[</span> , <span class="va">capacity_ratio_yoy</span> <span class="op">:=</span> <span class="va">census</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">census</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hospital_num"</span>,<span class="st">"year"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Similarly, users could define other indicators of typical occupancy
that are currently not supported by the function (e.g., trimmed
means).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by GEMINIdata.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
