<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data Coverage • Rgemini</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data Coverage">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Rgemini</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cell_suppression_and_table1.html">Cell Suppression and Table 1</a></li>
    <li><a class="dropdown-item" href="../articles/daily_census.html">Daily Census</a></li>
    <li><a class="dropdown-item" href="../articles/data_coverage.html">Data Coverage</a></li>
    <li><a class="dropdown-item" href="../articles/epicare_and_readmission.html">Episodes of care and Readmission</a></li>
    <li><a class="dropdown-item" href="../articles/icd_to_ccsr.html">ICD to CCSR</a></li>
    <li><a class="dropdown-item" href="../articles/plotting_data_exploration.html">Plotting Functions - Easy Plots for Data Exploration</a></li>
    <li><a class="dropdown-item" href="../articles/plotting_theme.html">Plotting Functions - Themes &amp; Colors</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Data Coverage</h1>
            
      

      <div class="d-none name"><code>data_coverage.Rmd</code></div>
    </div>

    
    
<hr>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code><a href="../reference/data_coverage.html">data_coverage()</a></code> function facilitates commonly
performed data coverage checks and is meant as a <strong>starting
point</strong> for data coverage exploration.</p>
<p>Although GEMINI aims to achieve high coverage of all data elements,
it’s possible that some tables could not be fully extracted from certain
hospitals/time periods. This is especially true for clinical variables,
such as lab, transfusion, radiology, or pharmacy data.</p>
<p>Therefore, one of the first steps of any analysis with GEMINI data
should be to carefully check data coverage for all relevant tables.
Depending on the research question, this may inform study feasibility,
cohort creation, decisions about imputation of missing values, and/or
modelling choices.</p>
<details><summary><strong>Expand this section for an example</strong>
</summary><p>If the goal of a project is to compare patients who received a blood
transfusion vs. those who did not, researchers first need to check data
coverage for the transfusion table. In this scenario, users cannot
simply check whether a given <code>genc_id</code> has an entry in the
transfusion table because there are 2 possible reasons for why a
<code>genc_id</code> might not exist in the transfusion table:</p>
<ol style="list-style-type: decimal">
<li>
<strong><em>Clinical reason:</em></strong> A transfusion may not
have been indicated (i.e., the patient did indeed not receive a
transfusion).</li>
<li>
<strong><em>Data coverage issue:</em></strong> The patient did
receive a blood transfusion, but the GEMINI transfusion table does not
contain the corresponding <code>genc_id</code> due to data coverage
issues (e.g., data extraction issue).</li>
</ol>
<p>We need to be able to differentiate between these 2 scenarios to
distinguish:</p>
<ol style="list-style-type: decimal">
<li>
<strong><em>True negatives:</em></strong> I.e., patient did indeed
not receive a transfusion, so we can set <code>transfused</code> to
<code>FALSE</code>.</li>
<li>
<strong><em>Transfusion status unknown:</em></strong> I.e., we do
not have sufficient data coverage to know whether the patient received a
transfusion, so we should set <code>transfused</code> to <code>NA</code>
(or exclude patients without transfusion coverage from the cohort).</li>
</ol>
<p>Additionally, if the goal is to analyze differences in transfusion
practices across hospitals, we also need to check whether there are
differences in data coverage timelines across sites. For example, if
some hospitals only have transfusion data <em>before</em> 2020, whereas
other hospitals only have transfusion data <em>after</em> 2020, any
between-hospital differences we observe may in fact be driven by changes
in transfusion practices over time (rather than reflecting true
differences between hospitals). We therefore need to carefully consider
which hospitals &amp; time periods to include in our analyses, and how
to account for differences in data coverage periods.</p>
</details><p><br></p>
<p>This vignette focuses on data coverage checks at the level of
<strong>tables</strong> - not individual columns within a given table.
This is because table-level data coverage is typically more challenging
to analyze and requires a thorough inspection and understanding of the
GEMINI cohort. By contrast, column-level missingness within a single
table can easily be checked using <a href="https://gemini-medicine.github.io/Rgemini/reference/n_missing.html"><code>Rgemini::n_missing()</code></a>.
Column-level missingness should typically follow the table-level
coverage checks discussed here.</p>
<p><br><br></p>
</div>
<div class="section level2">
<h2 id="lookup_coverage">Data coverage lookup table<a class="anchor" aria-label="anchor" href="#lookup_coverage"></a>
</h2>
<p>The <code><a href="../reference/data_coverage.html">data_coverage()</a></code> function queries the
<code>lookup_data_coverage</code> table, which lists the time periods
with coverage for each data table and hospital (also see Data
Availability plot in the <a href="https://geminimedicine.ca/the-gemini-database/" class="external-link">Data
Dictionary</a>). The min/max dates refer to the range of
<strong>discharge dates</strong> (from <code>admdad</code>) during which
there was <strong>at least 1 <code>genc_id</code></strong> with an entry
in a given table:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lookup_data_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span></span>
<span>  <span class="va">db</span>, <span class="st">"SELECT * from lookup_data_coverage;"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>This is an example (dummy version) of the
<code>lookup_data_coverage</code> table showing the min-max coverage
dates for different hospital*data combinations:</p>
</blockquote>
<div style="font-size: 10px;">
<table class="table">
<thead><tr>
<th style="text-align:center;">
data
</th>
<th style="text-align:center;">
hospital_num
</th>
<th style="text-align:center;">
min_date
</th>
<th style="text-align:center;">
max_date
</th>
<th style="text-align:center;">
additional_info
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
admdad
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2018-02-01
</td>
<td style="text-align:center;">
2023-03-31
</td>
<td style="text-align:center;">
Hospital opened in February 2018.
</td>
</tr>
<tr>
<td style="text-align:center;">
er
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2015-04-01
</td>
<td style="text-align:center;">
2023-06-30
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
pharmacy
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
2019-07-01
</td>
<td style="text-align:center;">
2023-03-31
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
radiology
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
2017-01-01
</td>
<td style="text-align:center;">
2023-06-30
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
transfusion
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
2015-04-01
</td>
<td style="text-align:center;">
2022-05-31
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
ipscu
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
Hospital does not have an ICU.
</td>
</tr>
<tr>
<td style="text-align:center;">
ipdiagnosis
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
2015-04-01
</td>
<td style="text-align:center;">
2023-06-30
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
lab
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
2017-04-01
</td>
<td style="text-align:center;">
2018-04-07
</td>
<td style="text-align:center;">
Hospital provides specialized care.
</td>
</tr>
<tr>
<td style="text-align:center;">
lab
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
2018-12-10
</td>
<td style="text-align:center;">
2021-10-15
</td>
<td style="text-align:center;">
Hospital provides specialized care.
</td>
</tr>
<tr>
<td style="text-align:center;">
lab
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
2022-03-30
</td>
<td style="text-align:center;">
2023-03-20
</td>
<td style="text-align:center;">
Hospital provides specialized care.
</td>
</tr>
<tr>
<td style="text-align:center;">
physicians
</td>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
2016-04-01
</td>
<td style="text-align:center;">
2023-03-31
</td>
<td style="text-align:center;">
</td>
</tr>
</tbody>
</table>
</div>
<p><br></p>
<p><strong>Additional notes:</strong></p>
<ul>
<li>The min/max dates in each row correspond to the start/end date of a
single data coverage period by hospital*table.</li>
<li>Hospital*table combinations with interrupted timelines are shown
across multiple rows (e.g., 3 rows for lab data at site 8).</li>
<li>Gaps in data coverage are defined as a period of &gt;28 consecutive
days without any data.</li>
<li>Rows where the dates are <code>NA</code> indicate hospital*table
combinations for which GEMINI does not have any data at all. This could
either mean that the data are not relevant to a given site (e.g.,
hospital 6 does not have an ICU) or that the data could not be
successfully extracted.</li>
<li>Encounters with a discharge date within the listed min-max periods
are assumed to have <strong><em>at least some</em></strong> data
coverage for that table, although coverage may still be low (see <a href="#plot_coverage">plot_coverage</a> below).</li>
<li>The <code>additional_info</code> column contains information that
may be helpful when interpreting the output of the
<code><a href="../reference/data_coverage.html">data_coverage()</a></code> function. When running
<code><a href="../reference/data_coverage.html">data_coverage()</a></code>, the function automatically prints all
relevant rows from this column in the terminal.</li>
</ul>
<p><br></p>
<p><strong style="color:red;">WARNING: </strong> <strong>Our threshold
for data coverage is currently extremely low!</strong> We assume that
there is <strong>some</strong> data coverage if there is <strong>at
least 1 <code>genc_id</code></strong> with an entry in a given table.
This does not tell us how high data coverage actually is (e.g., was
there only 1 <code>genc_id</code> or 1,000 <code>genc_ids</code> with an
entry in a given table?). Additionally, the definition only considers
gaps &gt;28 days, and does not exclude time periods with shorter gaps.
Therefore, users should only use this lookup table (and the accompanying
<code><a href="../reference/data_coverage.html">data_coverage()</a></code> function) as a starting point - to exclude
time periods where GEMINI did not receive any data at all. We highly
recommend performing additional coverage checks, in combination with
data quality assessments.</p>
<p><br><br></p>
</div>
<div class="section level2">
<h2 id="how-to-use-data_coverage">How to use <code>data_coverage()</code><a class="anchor" aria-label="anchor" href="#how-to-use-data_coverage"></a>
</h2>
<div class="section level3">
<h3 id="get-encounter-level-coverage-flag-without-plots">Get encounter-level coverage flag (without plots)<a class="anchor" aria-label="anchor" href="#get-encounter-level-coverage-flag-without-plots"></a>
</h3>
<p>The <code><a href="../reference/data_coverage.html">data_coverage()</a></code> function converts the
<code>lookup_data_coverage</code> table to an encounter-level table.
Let’s say we want to check which encounters in <code>admdad</code> were
discharged during time periods with any <code>lab</code>,
<code>transfusion</code>, and <code>radiology</code> data coverage:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get encounter-level coverage flags</span></span>
<span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_coverage.html">data_coverage</a></span><span class="op">(</span></span>
<span>  dbcon <span class="op">=</span> <span class="va">db</span>,</span>
<span>  cohort <span class="op">=</span> <span class="va">admdad</span>,</span>
<span>  table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lab"</span>, <span class="st">"transfusion"</span>, <span class="st">"radiology"</span><span class="op">)</span>,</span>
<span>  plot_timeline <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot_coverage <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>This is an example (dummy version) of the ouput table returned by
<code><a href="../reference/data_coverage.html">data_coverage()</a></code>:</p>
</blockquote>
<div style="font-size: 10px;">
<table class="table">
<thead><tr>
<th style="text-align:center;">
genc_id
</th>
<th style="text-align:center;">
hospital_num
</th>
<th style="text-align:center;">
discharge_date
</th>
<th style="text-align:center;">
lab
</th>
<th style="text-align:center;">
transfusion
</th>
<th style="text-align:center;">
radiology
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2019-12-31
</td>
<td style="text-align:center;">
TRUE
</td>
<td style="text-align:center;">
FALSE
</td>
<td style="text-align:center;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2022-03-12
</td>
<td style="text-align:center;">
TRUE
</td>
<td style="text-align:center;">
TRUE
</td>
<td style="text-align:center;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
2018-10-10
</td>
<td style="text-align:center;">
TRUE
</td>
<td style="text-align:center;">
TRUE
</td>
<td style="text-align:center;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
2017-10-15
</td>
<td style="text-align:center;">
FALSE
</td>
<td style="text-align:center;">
TRUE
</td>
<td style="text-align:center;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
2022-06-01
</td>
<td style="text-align:center;">
FALSE
</td>
<td style="text-align:center;">
FALSE
</td>
<td style="text-align:center;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
2018-12-22
</td>
<td style="text-align:center;">
TRUE
</td>
<td style="text-align:center;">
FALSE
</td>
<td style="text-align:center;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
2022-05-20
</td>
<td style="text-align:center;">
TRUE
</td>
<td style="text-align:center;">
TRUE
</td>
<td style="text-align:center;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
2021-07-30
</td>
<td style="text-align:center;">
TRUE
</td>
<td style="text-align:center;">
FALSE
</td>
<td style="text-align:center;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
2017-08-03
</td>
<td style="text-align:center;">
FALSE
</td>
<td style="text-align:center;">
TRUE
</td>
<td style="text-align:center;">
TRUE
</td>
</tr>
</tbody>
</table>
</div>
<p><br></p>
<p>The table contains a flag for each <code>genc_id</code> indicating
whether that <code>genc_id</code> was discharged from a hospital &amp;
during a time period where <strong>some</strong>
lab/transfusion/radiology data were available (according to the min-max
dates in the <a href="#lookup_coverage"><code>lookup_data_coverage</code></a>
table).</p>
<ul>
<li>
<strong>For <code>genc_ids</code> where the flag is
<code>FALSE</code></strong>: Based on the definition of data coverage in
the lookup table, these are encounters that were discharged from
hospitals/during time periods where GEMINI did not receive ANY data all
for a period of &gt;28 days. In other words, we do not have sufficient
data coverage to infer whether the encounter received a lab/imaging test
or transfusion. Therefore, these <code>genc_ids</code> should be
excluded (or set to <code>NA</code>) for any analyses relying on
lab/transfusion/radiology data.</li>
<li>
<strong>For <code>genc_ids</code> where the flag is
<code>TRUE</code></strong>: These are encounters that were discharged
from hospitals/during time periods with <strong>some</strong> data
coverage. This does <em>not</em> mean that all <code>genc_ids</code>
where the flag is <code>TRUE</code> have an entry in the
lab/transfusion/radiology table because:
<ol style="list-style-type: lower-alpha">
<li>Due to the low threshold for data coverage in the
<code>lookup_data_coverage</code> table, actual data coverage may still
be low during some time periods (see <a href="#plot_coverage"><code>plot_coverage</code></a> below).</li>
<li>For some tables, we would not expect all <code>genc_ids</code> to
have an entry even if data coverage is generally high (e.g., not all
patients receive a radiology test or blood transfusion).</li>
</ol>
</li>
</ul>
<p><br></p>
</div>
<div class="section level3">
<h3 id="plot-data-timelines-by-table-hospital">Plot data timelines by table &amp; hospital<a class="anchor" aria-label="anchor" href="#plot-data-timelines-by-table-hospital"></a>
</h3>
<p>To visualize the data timelines by hospital &amp; table, you can set
the <code>plot_timeline</code> input to <code>TRUE</code>, which will
result in a plot similar to the “Data Availability” plot in the data
dictionary. However, the plot returned by this function is customized to
the input cohort (e.g., time periods/hospitals of interest) and specific
tables that are relevant for your analyses.</p>
<p>For example, let’s say we are interested in the data timelines for
the <code>admdad</code>, <code>lab</code>, and <code>ipscu</code> table
for encounters discharged since April 2017:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get encounters discharged since Apr 2017</span></span>
<span><span class="va">admdad_subset</span> <span class="op">&lt;-</span> <span class="va">admdad</span><span class="op">[</span><span class="va">discharge_date_time</span> <span class="op">&gt;=</span> <span class="st">"2017-04-01 00:00"</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot data timelines</span></span>
<span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_coverage.html">data_coverage</a></span><span class="op">(</span></span>
<span>  dbcon <span class="op">=</span> <span class="va">db</span>,</span>
<span>  cohort <span class="op">=</span> <span class="va">admdad_subset</span>,</span>
<span>  table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"admdad"</span>, <span class="st">"lab"</span>, <span class="st">"ipscu"</span><span class="op">)</span>,</span>
<span>  plot_timeline <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_coverage <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fdata_coverage%2Fcoverage_timeline_plot.png" width="60%"></p>
<p><br></p>
<p><strong>Let’s inspect this plot. What should you look out
for?</strong></p>
<details><summary><strong>Expand this section for some tips</strong>
</summary><ul>
<li>
<strong>Between-hospital differences in data timelines</strong>
<ul>
<li>Looking at the timelines for <code>admdad</code>, you’ll notice that
some hospitals generally have later start dates (e.g., hospital 1)
and/or earlier end dates (e.g., hospitals 5 &amp; 6) compared to others.
The <code>additional_info</code> column in the
<code>lookup_data_coverage</code> table may provide an explanation for
some of these between-hospital differences in data timelines (e.g., see
above, for hospital 1: “Hospital opened in February 2018.”). Depending
on your research question, you may need to restrict your analyses to
time periods that overlap across all sites and/or exclude sites with
limited data timelines.</li>
</ul>
</li>
<li>
<strong>Within-hospital differences in data timelines</strong>
<ul>
<li>Even within the same hospital, data timelines can vary between
tables. For example at sites 4 and 9, lab data have a shorter coverage
period compared to <code>admdad</code>/<code>lab</code> data. This is
typically due to challenges associated with extracting clinical (as
opposed to administrative) data. If lab data are crucial for your
research question, keep in mind that the effective data timeline for
your analyses is determined by lab data coverage (rather than
<code>admdad</code> coverage).</li>
</ul>
</li>
<li>
<strong>Interrupted data timelines</strong>
<ul>
<li>For some hospitals/tables, data timelines may be interrupted. For
example, at site 8, lab data are not covered continuously. The
<code>additional_info</code> column may contain some information that
can help interpretation. For example, for site 8 lab data, the table
states that this “Hospital provides specialized care”. It’s possible
that lab testing is not performed on a routine basis at specialized
hospitals and that the % of encounters with lab tests is generally very
low even for time periods that are shown as “covered” in the timeline
plot (remember that a single <code>genc_id</code> with lab data is
sufficient for data coverage to be shown as <code>TRUE</code> in this
plot). In other words, the gaps in the data timeline might not
necessarily reflect a data extraction issue, but rather could be an
indicator of specialized clinical practice at this site. Therefore, it
is important to inspect overall data volume for sites with interrupted
data timelines and plot the % data coverage (see <a href="#plot_coverage">plot_coverage</a> below). If lab data are crucial
for your research question, you may consider exlcuding specialized
hospitals with low lab data coverage/volume.</li>
</ul>
</li>
<li>
<strong>Empty rows</strong>
<ul>
<li>Some tables may not appear in the timeline plot at all for certain
hospitals. For example, sites 6 &amp; 8 have an empty <code>ipscu</code>
row. According to the <code>additional_info</code> column in the
<code>lookup_data_coverage</code> table, site 6 does not have an ICU.
This information can help us determine how to deal with this site in our
analyses. For example, if we are simply looking at the
<code>ipscu</code> table to determine if a <code>genc_id</code> was
admitted to an ICU during their hospitalization, we can still include
site 6 in our analyses and set <code>icu_entry</code> to
<code>FALSE</code> for all encounters at this site (we know for a fact
that patients were not admitted to an ICU while being hospitalized at
site 6). By contrast, if we are planning to perform more in-depth
analyses of <code>ipscu</code> data (e.g., analyses of lab tests
performed in the ICU), site 6 would need to be excluded since it would
not contribute any data points to those analyses.</li>
</ul>
</li>
</ul></details><p><br><br></p>
<p>In addition to the plot, the function also returns a list object with
several entries:</p>
<ul>
<li>The 1st list item (<code>coverage_flag_enc</code>) contains the
table with encounter-level flags based on
<code>lookup_data_coverage</code> (also see section above):</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># = coverage$coverage_flag_enc</span></span></code></pre></div>
<div style="font-size: 10px;">
<table class="table">
<thead><tr>
<th style="text-align:right;">
genc_id
</th>
<th style="text-align:left;">
hospital_num
</th>
<th style="text-align:left;">
discharge_date
</th>
<th style="text-align:left;">
admdad
</th>
<th style="text-align:left;">
ipscu
</th>
<th style="text-align:left;">
lab
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2018-09-13
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
2023-02-01
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
2023-01-20
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2018-07-10
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
2019-10-10
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2019-09-21
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
2020-12-26
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2020-12-06
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
2019-04-23
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:left;">
2022-03-02
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
</tbody>
</table>
</div>
<p><br></p>
<ul>
<li>The 2nd list item (<code>timeline_data</code>) is the DB
availability table with min-max dates per site &amp; table (i.e., what’s
shown in the data timeline plot)</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="co"># = coverage$timeline_data</span></span></code></pre></div>
<div style="font-size: 10px;">
<table class="table">
<thead><tr>
<th style="text-align:left;">
hospital_num
</th>
<th style="text-align:left;">
data
</th>
<th style="text-align:left;">
min_date
</th>
<th style="text-align:left;">
max_date
</th>
<th style="text-align:left;">
additional_info
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
admdad
</td>
<td style="text-align:left;">
2018-02-01
</td>
<td style="text-align:left;">
2023-03-31
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
ipscu
</td>
<td style="text-align:left;">
2018-02-01
</td>
<td style="text-align:left;">
2023-03-31
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
lab
</td>
<td style="text-align:left;">
2018-02-01
</td>
<td style="text-align:left;">
2023-03-31
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
admdad
</td>
<td style="text-align:left;">
2018-10-01
</td>
<td style="text-align:left;">
2023-06-30
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
ipscu
</td>
<td style="text-align:left;">
2018-10-01
</td>
<td style="text-align:left;">
2023-06-30
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
lab
</td>
<td style="text-align:left;">
2018-10-01
</td>
<td style="text-align:left;">
2023-06-30
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
admdad
</td>
<td style="text-align:left;">
2018-10-01
</td>
<td style="text-align:left;">
2023-06-30
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
ipscu
</td>
<td style="text-align:left;">
2018-10-01
</td>
<td style="text-align:left;">
2023-06-30
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
lab
</td>
<td style="text-align:left;">
2018-10-01
</td>
<td style="text-align:left;">
2023-06-30
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
admdad
</td>
<td style="text-align:left;">
2017-04-01
</td>
<td style="text-align:left;">
2023-06-30
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<p><br></p>
<ul>
<li>
<p>The 3rd list item (<code>timeline_plot</code>) is a ggplot object
containing the timeline plot, which can be further customized/exported
in the desired format.</p>
<p>For example, you could customize the title of the plot and move the
legend position:</p>
</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="co"># = coverage$timeline_plot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Data coverage exploration\n\n"</span>, subtitle <span class="op">=</span> <span class="st">"GEMINI project XYZ"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><br><br></p>
</div>
<div class="section level3">
<h3 id="plot_coverage">Plot % data coverage<a class="anchor" aria-label="anchor" href="#plot_coverage"></a>
</h3>
<p>The encounter-level flags and timeline plot only provide very limited
insights into actual data coverage, since they simply reflect the
min-max dates listed in the <code>lookup_data_coverage</code> table,
which lists all time periods with any data even if just 1
<code>genc_id</code> had a table entry. This is problematic because
there may be time periods with very low coverage that aren’t currently
excluded from the <code>lookup_data_coverage</code> table. Therefore,
users should always perform additional coverage checks by plotting the %
of encounters with an entry in a given table by hospital &amp; month.
This can be achieved by setting the <code>plot_coverage</code> input to
<code>TRUE</code>. Users should then carefully inspect the coverage over
time and decide how to handle time periods/hospitals with low coverage
in their analyses.</p>
<p><strong style="color:red;">WARNING: </strong> When plotting data
coverage, your cohort input should only be pre-filtered for the
hospitals and overall timelines of interest. You <strong>should
not</strong> apply any other cohort inclusion/exclusion criteria (e.g.,
diagnosis codes etc.). This is to ensure that the coverage plots are
representative of the overall GEMINI data holdings, and are not skewed
by any project-specific cohort inclusion/exclusion steps.</p>
<p><br></p>
<p>Let’s plot coverage for the transfusion table for patients discharged
since April 2017:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot coverage (% genc_ids with entry in table)</span></span>
<span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_coverage.html">data_coverage</a></span><span class="op">(</span></span>
<span>  dbcon <span class="op">=</span> <span class="va">db</span>,</span>
<span>  cohort <span class="op">=</span> <span class="va">admdad_subset</span>,</span>
<span>  table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"transfusion"</span><span class="op">)</span>,</span>
<span>  plot_timeline <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot_coverage <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fdata_coverage%2Fcoverage_plot.png" width="60%"></p>
<p><br></p>
<p>The expected percentage of <code>genc_ids</code> with an entry in a
given table depends on the clinical context &amp; differences in
practice across sites (e.g., how many patients receive a transfusion
vs. a lab/imaging test etc.). Therefore, there is no single threshold
that can be applied to define “good” coverage across different
tables/hospitals.</p>
<p><strong>With that in mind, how would you evaluate this coverage plot
for transfusion data?</strong></p>
<details><summary><strong>Expand this section to learn more</strong>
</summary><p>Users should carefully inspect these plots for unexpected patterns
(e.g., sudden drops) and further inspect a) what’s driving these
patterns, and b) how to handle time periods with low data coverage in
their analyses. Here are a few specific examples of what to look out
for:</p>
<ul>
<li>
<strong>Hospitals/time periods with no data coverage</strong>
<ul>
<li>Some hospitals don’t have any transfusion data at all (e.g., sites 5
&amp; 6) or don’t have any transfusion coverage during certain time
periods (e.g., hospital 1/4/8/9).* Note that time periods with 0%
coverage could also be inferred from the timeline plot, which would have
empty rows for any tables without any data coverage (see <a href="#plot_timeline"><code>plot_timeline</code></a>). However, the
coverage plots provide more granular insights into coverage - beyond 0
vs. non-0 - allowing users to compare coverage between hospitals and
over time on a continuous scale.</li>
</ul>
</li>
<li>
<strong>Differences between hospitals</strong>
<ul>
<li>For hospitals with transfusion data, we may see large differences in
the % of encounters with an entry in the transfusion table (e.g.,
&gt;15% at site 3 vs. &lt;5% at site 8). This may not necessarily
reflect differences in data coverage, but could be due to differences in
clinical practice or medical subservices provided at different sites. As
discussed above, we already know that site 8 provides specialized care.
To check whether this might explain low transfusion rates, users could
inspect the medical subservices provided at this site (e.g.,
<code>mrp_service</code> field in <code>admdad</code>) and could also
check for potential differences in patient populations (e.g., most
responsible diagnosis groups) at different sites. If transfusion data
are crucial for the research question of interest, it may make sense to
exclude hospitals with low transfusion data volume.</li>
</ul>
</li>
<li>
<strong>Sudden drops in data coverage</strong>
<ul>
<li>At hospital 7, we can see a large drop in the % transfusion coverage
in the first quarter of 2019. Sudden, temporary drops like this
typically reflect a data coverage issue (e.g., due to data extraction
challenges, EHR transition etc.). Occassionally, these drops could also
be due to temporary changes in clinical practice (e.g., COVID-19 waves,
blood product shortages etc.) - although we would typically expect these
changes to be more gradual and affect all hospitals. Depending on your
research question, you may need to remove hospitals/time periods with
low data coverage from your analyses, especially if you suspect a data
coverage issue. Note that coverage drops like this would not be
reflected in the timeline plot shown above because coverage was &gt;
0%.</li>
</ul>
</li>
<li>
<strong>Gradual changes in coverage over time</strong>
<ul>
<li>At site 2, we can observe a gradual decrease in the % of encounters
with a transfusion. This could be due to several different reasons:
<ol style="list-style-type: decimal">
<li>There may have been a change in clinical practice over time (e.g.,
new transfusion guidelines specific to this site)</li>
<li>Changes in the patient cohort/medical subspecialties: It’s worth
inspecting if patient characteristics remained constant over time, or
whether there are reasons you’d expect transfusion rates to decrease
over time (e.g., larger proportion of patients with no medical
indication for a transfusion?)</li>
<li>It’s possible that gradual changes in coverage are driven by data
extraction issues. For example, later time periods may be missing
transfusion entries for a certain subset of the GEMINI cohort (e.g., ICU
patients). Hence, it could be worth plotting coverage for different
patient cohorts separately (see cohort flags like <code>gim</code> or
<code>all_med</code> in the <code>derived_variables</code> table).</li>
<li>Finally, note that we are plotting data coverage by discharge month
here (rather than transfusion month). This can potentially mask issues
related to the extraction of transfusion products that were transfused
during certain time periods. We therefore recommend plotting coverage by
the relevant clinical date-time variable (i.e., issue_date_time for
transfusions) in addition to the plots by discharge_date_time. Note that
this is currently not supported by data_coverage() but can easily be
achieved using Rgemini::plot_over_time() (e.g., time_var would be
issue_date_time in the case of transfusions). This may show a more
abrupt drop in data coverage and could indicate issues with data storage
in the hospital’s EHR (e.g., system outage) rather than data extraction
issues (which are typically related to discharge_date_time since GEMINI
data are pulled by discharge date).</li>
</ol>
</li>
</ul>
</li>
</ul>
<p><br></p>
**As a side note: 0 in the coverage plot indicates that there were some
encounters in the cohort during these time periods (i.e.,
<code>admdad</code> data are available), but none of the encounters had
an entry in the <code>transfusion</code> table. By contrast, time
periods that are not covered in the cohort/admdad table are shown as
<code>NA</code> in these plots. For example, at site 1, we can see that
the cohort only starts in February 2018 in line with the
<code>additional_info</code> column stating that this hospital only
opened in February 2018. between Feb 2018 - Jan 2020, GEMINI did not
receive any transfusion data for the encounters from this site (%
coverage = 0). Since January 2020, GEMINI has started receiving
transfusion data with ~15-20% of encounters having an entry in the
transfusion table at this site.
</details><p><br></p>
<p>In addition to printing the coverage plot, the function will also
return a list object similar to the one above:</p>
<ol style="list-style-type: decimal">
<li>
<code>coverage_flag_enc</code>: Encounter-level data coverage
flag</li>
<li>
<code>coverage_data</code>: Table showing the % of encounters with a
table entry by hospital &amp; discharge month</li>
<li>
<code>coverage_plot</code>: ggplot object containing coverage
plot</li>
</ol>
<p>Here is an example of the <code>coverage_data</code> table, which can
be used to detect (and exclude) hospitals/months with low coverage. It
also shows the number of encounters (<code>n_encounters</code>) that are
in the denominator for each hospital * month combination based on the
user-provided cohort input.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="co"># = coverage$coverage_data</span></span></code></pre></div>
<div style="font-size: 10px;">
<table class="table">
<thead><tr>
<th style="text-align:left;">
discharge_month
</th>
<th style="text-align:left;">
hospital_num
</th>
<th style="text-align:right;">
prct_transfusion_entry
</th>
<th style="text-align:right;">
n_encounters
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
2017-04-01
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-04-01
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-04-01
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-04-01
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
533
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-04-01
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1145
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-04-01
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
700
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-04-01
</td>
<td style="text-align:left;">
7
</td>
<td style="text-align:right;">
13.74
</td>
<td style="text-align:right;">
844
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-04-01
</td>
<td style="text-align:left;">
8
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-04-01
</td>
<td style="text-align:left;">
9
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
652
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-05-01
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<p><br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="further-customization">Further customization<a class="anchor" aria-label="anchor" href="#further-customization"></a>
</h2>
<div class="section level3">
<h3 id="hospital_label-hospital_group">
<code>hospital_label</code> &amp; <code>hospital_group</code><a class="anchor" aria-label="anchor" href="#hospital_label-hospital_group"></a>
</h3>
<p>Users can further customize the timeline &amp; coverage plots by
providing <code>hospital_label</code> (e.g., letters A-E instead of
<code>hospital_num</code> 101-105) and/or <code>hospital_group</code>
(e.g., “Teaching” vs. “Non-teaching hospital”) inputs.</p>
<p>For example, let’s say our <code>admdad_subset</code> table contains
a user-created label (<code>hosp_label</code>) and hospital grouping
variable (<code>hosp_type</code>). We can now provide these variable
names as inputs to <code>data_coverage</code>:
<code>hospital_label</code> will change the labels of hospitals on the
y-axis of the timeline plot whereas <code>hospital_group</code> will
color code hospitals according to their category. We can also customize
the color scheme by providing a <code>colors</code> input:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_coverage.html">data_coverage</a></span><span class="op">(</span></span>
<span>  dbcon <span class="op">=</span> <span class="va">db</span>,</span>
<span>  cohort <span class="op">=</span> <span class="va">admdad_subset</span>,</span>
<span>  table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"admdad"</span><span class="op">)</span>,</span>
<span>  plot_timeline <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_coverage <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  hospital_label <span class="op">=</span> <span class="st">"hosp_label"</span>,</span>
<span>  hospital_group <span class="op">=</span> <span class="st">"hosp_type"</span>,</span>
<span>  colors <span class="op">=</span> <span class="fu"><a href="../reference/gemini_colors.html">gemini_colors</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fdata_coverage%2Fcoverage_custom_plot1.png" width="60%"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="custom_dates">
<code>custom_dates</code><a class="anchor" aria-label="anchor" href="#custom_dates"></a>
</h3>
<p>In some cases, users may want to provide customized timelines for a
given hospital*table combination to apply further inclusions/exclusions
(e.g., due to data quality issues, column-level missingness, etc.). For
example, let’s say you identified a data quality issue with lab data at
hospital 4 for discharge dates prior to April 2019 and now only want to
include encounters that were discharged after that date. This can be
achieved by providing a <code>custom_dates</code> input to
<code><a href="../reference/data_coverage.html">data_coverage()</a></code>, which will overwrite the rows for the
corresponding hospital*table combinations in the
<code>lookup_data_coverage</code> table. As a result, the
encounter-level flags and timeline plot will be adjusted according to
the user-specified dates. Note that the coverage plot (see <a href="#coverage_plot">above</a>) is not affected by the
<code>custom_dates</code> input.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define customized dates</span></span>
<span><span class="va">custom_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lab"</span><span class="op">)</span>,</span>
<span>  hospital_num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  min_date <span class="op">=</span> <span class="st">"2019-04-01"</span>,</span>
<span>  max_date <span class="op">=</span> <span class="st">"2023-06-30"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_coverage.html">data_coverage</a></span><span class="op">(</span></span>
<span>  db <span class="op">=</span> <span class="va">dbcon</span>,</span>
<span>  cohort <span class="op">=</span> <span class="va">admdad_subset</span>,</span>
<span>  table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lab"</span><span class="op">)</span>,</span>
<span>  plot_timeline <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_coverage <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  custom_dates <span class="op">=</span> <span class="va">custom_dates</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="figures%2Fdata_coverage%2Fcoverage_custom_plot2.png" width="60%"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="as_plotly">
<code>as_plotly</code><a class="anchor" aria-label="anchor" href="#as_plotly"></a>
</h3>
<p>Finally, users can set <code>as_plotly</code> to <code>TRUE</code>.
This will return any figures created by <code><a href="../reference/data_coverage.html">data_coverage()</a></code> as
<code>ggplotly</code> objects, which facilitates interactive exploration
of the timeline/coverage plots. Note that this is currently not
supported on HPC4Health due to vulnerabilities associated with the
<code>plotly</code> package.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by GEMINIdata.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
