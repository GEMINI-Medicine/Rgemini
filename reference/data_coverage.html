<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Dummy data for data_coverage function Coverage data — data_coverage • Rgemini</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dummy data for data_coverage function Coverage data — data_coverage"><meta name="description" content='This function facilitates data coverage checks that analysts should perform
during data exploration &amp;amp; cohort generation. Specifically, this function
checks for "gaps" in the data timeline (e.g., are there any hospitals/time
periods for which GEMINI did not receive any data at all?), and also provides
more detailed insights into data volume &amp;amp; coverage by month and hospital
(e.g., what percentage of encounters have an entry in a given table?).
All checks performed by this function are applied at the table level (i.e.,
missing values in individual columns are not considered and should be checked
separately).'><meta property="og:description" content='This function facilitates data coverage checks that analysts should perform
during data exploration &amp;amp; cohort generation. Specifically, this function
checks for "gaps" in the data timeline (e.g., are there any hospitals/time
periods for which GEMINI did not receive any data at all?), and also provides
more detailed insights into data volume &amp;amp; coverage by month and hospital
(e.g., what percentage of encounters have an entry in a given table?).
All checks performed by this function are applied at the table level (i.e.,
missing values in individual columns are not considered and should be checked
separately).'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Rgemini</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/cell_suppression_and_table1.html">Cell Suppression and Table 1</a></li>
    <li><a class="dropdown-item" href="../articles/daily_census.html">Daily Census</a></li>
    <li><a class="dropdown-item" href="../articles/data_coverage.html">Data Coverage</a></li>
    <li><a class="dropdown-item" href="../articles/epicare_and_readmission.html">Episodes of care and Readmission</a></li>
    <li><a class="dropdown-item" href="../articles/icd_to_ccsr.html">ICD to CCSR</a></li>
    <li><a class="dropdown-item" href="../articles/plotting_data_exploration.html">Plotting Functions - Easy Plots for Data Exploration</a></li>
    <li><a class="dropdown-item" href="../articles/plotting_theme.html">Plotting Functions - Themes &amp; Colors</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Dummy data for <code>data_coverage</code> function Coverage data</h1>

      <div class="d-none name"><code>data_coverage.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function facilitates data coverage checks that analysts should perform
during data exploration &amp; cohort generation. Specifically, this function
checks for "gaps" in the data timeline (e.g., are there any hospitals/time
periods for which GEMINI did not receive any data at all?), and also provides
more detailed insights into data volume &amp; coverage by month and hospital
(e.g., what percentage of encounters have an entry in a given table?).
All checks performed by this function are applied at the table level (i.e.,
missing values in individual columns are not considered and should be checked
separately).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">data_coverage</span><span class="op">(</span></span>
<span>  <span class="va">dbcon</span>,</span>
<span>  <span class="va">cohort</span>,</span>
<span>  <span class="va">table</span>,</span>
<span>  plot_timeline <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_coverage <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  hospital_label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  hospital_group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  custom_dates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  as_plotly <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dbcon">dbcon<a class="anchor" aria-label="anchor" href="#arg-dbcon"></a></dt>
<dd><p>(<code>DBIConnection</code>)<br>
A database connection to any GEMINI database.</p></dd>


<dt id="arg-cohort">cohort<a class="anchor" aria-label="anchor" href="#arg-cohort"></a></dt>
<dd><p>(<code>data.frame</code> or <code>data.table</code>)
Cohort table with all relevant encounters of interest, where each row
corresponds to a single encounter. Must contain the following columns:</p><ul><li><p><code>genc_id</code>: GEMINI Encounter ID</p></li>
<li><p><code>hospital_num</code> | <code>hospital_id</code>: Hospital identifier</p></li>
<li><p><code>discharge_date_time</code></p></li>
</ul></dd>


<dt id="arg-table">table<a class="anchor" aria-label="anchor" href="#arg-table"></a></dt>
<dd><p>(<code>character</code>)
Which table(s) to include. If multiple, specify a character vector
(e.g., <code>table = c("lab", "pharmacy", "radiology")</code>).</p>
<p>For HPC4Health users: Please specify the full table name as it is listed in
your datacut (e.g., <code>"admdad_subset"</code> instead of only <code>"admdad"</code>).</p></dd>


<dt id="arg-plot-timeline">plot_timeline<a class="anchor" aria-label="anchor" href="#arg-plot-timeline"></a></dt>
<dd><p>(<code>logical</code>)
Flag indicating whether to plot an overview of data timelines by hospital and
table.
<strong>Note:</strong> This plot only shows a rough overview of min-max dates per table
for each hospital. Gaps in this plot illustrate time periods where no data
were available for &gt;28 consecutive days. Importantly, for time
periods without any gaps, overall data volume may still be low and certain
entries/columns may still be missing. Users should further inspect the
coverage plots (<code>plot_coverage = TRUE</code>) and perform additional customized
checks based on their needs.</p></dd>


<dt id="arg-plot-coverage">plot_coverage<a class="anchor" aria-label="anchor" href="#arg-plot-coverage"></a></dt>
<dd><p>(<code>logical</code>)
Flag indicating whether to plot data coverage. These plots show the
percentage of <code>genc_ids</code> with an entry in the table(s) of interest. Data
coverage is plotted by hospital and discharge month (because GEMINI data are
pulled based on encounters' discharge date). Users should carefully inspect
these plots for any drops/gaps in coverage that may not be visible in the
timeline plots (see <code>plot_timeline</code> above). When plotting the <code>admdad</code> table,
the function will plot the number of encounters by discharge month to show
overall data volume (note: by definition, 100% of <code>genc_ids</code> in GEMINI data
have an entry in <code>admdad</code>).</p></dd>


<dt id="arg-hospital-label">hospital_label<a class="anchor" aria-label="anchor" href="#arg-hospital-label"></a></dt>
<dd><p>(<code>character</code>)
Optional: Name of variable in <code>cohort</code> table that corresponds to custom
label for hospitals (e.g., letters A-E instead of hospital_num 101-105).
Will be used for plotting purposes.</p></dd>


<dt id="arg-hospital-group">hospital_group<a class="anchor" aria-label="anchor" href="#arg-hospital-group"></a></dt>
<dd><p>(<code>character</code>)
Optional: Name of variable in <code>cohort</code> table that corresponds to grouping
of hospitals (e.g., Teaching vs. Non-teaching). Hospitals will be grouped
accordingly in all plots/output tables.</p></dd>


<dt id="arg-custom-dates">custom_dates<a class="anchor" aria-label="anchor" href="#arg-custom-dates"></a></dt>
<dd><p>(<code>data.frame</code>|<code>data.table</code>)
Optional input allowing users to specify a customized timeline (in 'yyyy-mm-dd'
format) to be included for a given hospital*table combination. The user-provided
input overwrites the corresponding row(s) in the <code>lookup_data_coverage</code> table.
This can be used to exclude time periods (e.g., due to data quality
issues) and generate customized timeline plots.
For example, let's say you identified a data quality issue in the
transfusion table at hospital 104 for discharge dates &lt; 2019-01-01.
To only include transfusion data for encounters discharged after this
time period, specify:
<code>custom_dates &lt;- data.frame( data = "transfusion", hospital_num = 104, min_date = "2019-01-01", max_date = "2022-06-30" )</code></p>
<p>This will overwrite the <code>min_date</code>/<code>max_date</code> values for site 104
transfusion data in the <code>lookup_data_coverage</code> table (data for all other
hospital*table combinations will remain the same). Additionally, the coverage
flags by <code>genc_id</code> (in returned <code>coverage_flag_enc</code>) and timeline plot (see
<code>plot_timeline</code>) will be adjusted according to the user-provided dates.
The coverage plot (see <code>plot_coverage</code>) is not affected by the user-specified
the <code>custom_dates</code> input.</p></dd>


<dt id="arg-as-plotly">as_plotly<a class="anchor" aria-label="anchor" href="#arg-as-plotly"></a></dt>
<dd><p>(<code>logical</code>)
Will return any figures as interactive plots using <code>plotly</code>. Note that this
may affect plot aesthetics.
The flag will be ignored if the <code>plotly</code> package is not installed.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional inputs that can be passed to control plot aesthetics in
<code>plot_timeline</code> or <code>plot_coverage</code> plots, such as:</p><ul><li><p><code>base_size</code>: Font size (default = 12)</p></li>
<li><p><code>colors</code>: Plot color(s) (default = gemini_colors(1))</p></li>
<li><p><code>hospital_group</code>: Name of variable in cohort specifying color grouping of
hospitals (e.g., Teaching/Non-teaching); for the timeline plot, this is
only applied when plotting a single table (otherwise, color grouping is
applied to different table names by default)</p></li>
</ul><p>For coverage plots only (inputs are passed to <code><a href="plot_over_time.html">plot_over_time()</a></code>):</p><ul><li><p><code>time_int</code>: Time interval used to aggregate data (e.g., by <code>"month"</code>
= default, <code>"quarter"</code>, or <code>"year"</code>)</p></li>
<li><p><code>ylimits</code>: Limits of y-axis (e.g., <code>c(0, 50)</code>)</p></li>
<li><p><code>scales</code>: Passed to facet wrap to control if y-scales are <code>"fixed"</code>
(default) or <code>"free"</code> (only works if no <code>ylimits</code> specified)</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If the plotting flags are set to <code>FALSE</code>, this function will return a single
<code>data.table</code> object with a flag for each <code>genc_id</code> indicating whether the
encounter was discharged during a time period in which data for a given
table (e.g., <code>"lab"</code>) were <em>in principle</em> available. If the flag is <code>FALSE</code>,
the <code>genc_id</code> was dicharged during a time period where GEMINI did not receive
any data for the table of interest. If the flag is <code>TRUE</code>, the <code>genc_id</code> was
discharged during a time period where GEMINI received <em>some</em> data from a
given hospital (however, coverage may still be low, so users are advised to
perform additional coverage checks, e.g., by using the plotting features of
this function).</p>
<p>When the plotting flags are set to <code>TRUE</code> (default), the function will
return additional data tables (<code>output[["data"]]</code>) and plots
(<code>output[["plots"]]</code>):</p><ul><li><p>If <code>plot_timeline = TRUE</code>: Returns <code>timeline_plot</code> showing an overview of
data timelines by hospital for each table. Will also return the corresponding
data table <code>timeline_data</code> that lists the min - max dates of each table per
site (in long format, where tables with multiple rows per hospital indicate
gaps in the data timeline)</p></li>
<li><p>If <code>plot_coverage = TRUE</code>: Returns <code>coverage_plot</code> showing the percentage
of <code>genc_ids</code> with an entry in a given table by discharge month and hospital.
Will also return the plotted data as <code>coverage_data</code> to facilitate further
inspection.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>data_coverage</code> provides analysts with a tool to inform their decisions
about which hospitals/time periods to include in their analyses,
depending on the data tables of interest. For example, if a project relies on
lab data (e.g., <code>mlaps</code> variable), users should carefully inspect lab data
coverage (see <code>plot_coverage</code> below). If lab data coverage is high (e.g.,
\&gt;95% of <code>genc_ids</code> have an entry in the lab table), individual <code>genc_ids</code>
may still not exist in the lab table (e.g., because lab testing was not
indicated) and individual lab columns might still have missing values.
Users should carefully consider how to handle these cases depending on the
context of their analyses.</p>
    </div>
    <div class="section level2">
    <h2 id="warning-">Warning!<a class="anchor" aria-label="anchor" href="#warning-"></a></h2>



<ul><li><p>Data coverage checks should generally be performed on the whole
dataset, prior to applying any additional cohort inclusions/exclusions.</p></li>
<li><p>If you are an HPC4Health user and your datacut has been pre-filtered
based on certain inclusion/exclusion criteria (e.g., diagnosis codes),
please keep in mind that the coverage plots (see <code>plot_coverage</code>) may be
skewed in smaller/pre-filtered samples. Please reach out to the GEMINI
team if you need additional support.</p></li>
<li><p>Data coverage checks are particularly relevant for clinical data
tables (e.g., lab, pharmacy, radiology, transfusions, vitals, clinical
notes etc.).</p></li>
<li><p>This function should be used as a starting point for data coverage
checks, but users are advised to perform additional checks based on their
specific needs.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">drv</span> <span class="op">&lt;-</span> <span class="fu">dbDriver</span><span class="op">(</span><span class="st">"PostgreSQL"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dbcon</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="va">drv</span>,</span></span>
<span class="r-in"><span>  dbname <span class="op">=</span> <span class="st">"db"</span>,</span></span>
<span class="r-in"><span>  host <span class="op">=</span> <span class="st">"domain_name.ca"</span>,</span></span>
<span class="r-in"><span>  port <span class="op">=</span> <span class="fl">1234</span>,</span></span>
<span class="r-in"><span>  user <span class="op">=</span> <span class="fu">getPass</span><span class="op">(</span><span class="st">"Enter user:"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  password <span class="op">=</span> <span class="fu">getPass</span><span class="op">(</span><span class="st">"password"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="fu">dbGetQuery</span><span class="op">(</span><span class="va">db</span>, <span class="st">"SELECT genc_id FROM admdad;"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## run function with default flags to create all plots</span></span></span>
<span class="r-in"><span><span class="co"># Note: This might take a while to run...</span></span></span>
<span class="r-in"><span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu">data_coverage</span><span class="op">(</span><span class="va">dbcon</span>, <span class="va">cohort</span>, table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"admdad"</span>, <span class="st">"radiology"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get flags per encounter based on encounter's discharge date</span></span></span>
<span class="r-in"><span><span class="va">enc_flag</span> <span class="op">&lt;-</span> <span class="va">coverage</span><span class="op">[[</span><span class="st">"data"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># coverage[["data"]]$coverage_flag_enc</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get data timeline (min-max dates)</span></span></span>
<span class="r-in"><span><span class="va">data_timeline</span> <span class="op">&lt;-</span> <span class="va">coverage</span><span class="op">[[</span><span class="st">"data"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="co"># coverage[["data"]]$timeline_data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get % encounters with entry in each table by discharge month &amp; hospital</span></span></span>
<span class="r-in"><span><span class="va">prct_coverage</span> <span class="op">&lt;-</span> <span class="va">coverage</span><span class="op">[[</span><span class="st">"data"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="co"># coverage[["data"]]$coverage_data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## run function without any plots</span></span></span>
<span class="r-in"><span><span class="co"># (will only return data.table with encounter-level flag)</span></span></span>
<span class="r-in"><span><span class="va">coverage</span> <span class="op">&lt;-</span> <span class="fu">data_coverage</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">dbcon</span>,</span></span>
<span class="r-in"><span>  <span class="va">cohort</span>,</span></span>
<span class="r-in"><span>  table <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"admdad"</span>, <span class="st">"radiology"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  plot_timeline <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  plot_coverage <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by GEMINIdata.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

